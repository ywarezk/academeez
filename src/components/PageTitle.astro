---
import Default from '@astrojs/starlight/components/PageTitle.astro';
import { AvatarFull } from './Avatar';
import { getEntry } from 'astro:content';

const locale = Astro.currentLocale || 'en';

const data = Astro.locals.starlightRoute.entry.data;

// authors in frontmatter is ["yariv-katz"] -> resolve from the "authors" collection
const authorSlugs = Array.isArray(data.authors) ? data.authors : data.authors ? [data.authors] : [];
const authorsEntries = await Promise.all(authorSlugs.map((slug) => getEntry('authors', slug)));
const authors = authorsEntries.filter(
	(a): a is NonNullable<typeof a> => a != null && a.data?.name != null && a.data?.avatar != null
);

const publishDate = new Date(data.publishDate);
const publishISO = publishDate.toISOString();
const publishHuman = publishDate.toLocaleDateString(locale, {
	year: 'numeric',
	month: 'long',
	day: 'numeric',
});
---

<Default {...Astro.props} />

{
	authors.length > 0 && (
		<div class="mt-6 flex flex-wrap items-center gap-4 text-sm text-muted-foreground">
			{/* Avatars + names (each links to /authors/[slug] via your AvatarFull) */}
			<div class="flex items-center gap-3">
				{authors.map((a) => (
					<AvatarFull
						client:load
						avatar={a.data.avatar}
						key={a.slug}
						name={a.data.name}
						slug={a.slug}
						className="ring-1 ring-border"
					/>
				))}
			</div>

			{/* Separator dot */}
			<span aria-hidden="true" class="hidden md:inline">
				â€¢
			</span>

			{/* Published date */}
			<time
				datetime={publishISO}
				class="text-sm font-normal font-sans text-muted-foreground leading-none"
			>
				{publishHuman}
			</time>
		</div>
	)
}
